<div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-12-29T07:27:40.000Z" title="2023/12/29 15:27:40">2023-12-29</time>发表</span><span class="level-item"><time dateTime="2023-12-31T10:02:01.810Z" title="2023/12/31 18:02:01">2023-12-31</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/qianj-work/">qianj-work</a></span><span class="level-item">1 分钟读完 (大约133个字)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">centos7自定义关机前执行脚本</h1><div class="content"><!-- more -->

<h1 id="创建脚本"><a href="#创建脚本" class="headerlink" title="创建脚本"></a>创建脚本</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /opt/test.sh &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> `<span class="built_in">date</span> <span class="string">&quot;+%G-%m-%d %H-%M-%S&quot;</span>` &gt;&gt; /opt/test.log</span><br><span class="line"> </span><br><span class="line">EOF</span><br><span class="line"><span class="built_in">chmod</span> +x /opt/test.sh</span><br></pre></td></tr></table></figure>
<h1 id="创建systemd服务"><a href="#创建systemd服务" class="headerlink" title="创建systemd服务"></a>创建systemd服务</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /usr/lib/systemd/system/stopSrv.service &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=close services before reboot and shutdown</span></span><br><span class="line"><span class="string">DefaultDependencies=no</span></span><br><span class="line"><span class="string">Before=shutdown.target reboot.target halt.target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">Type=oneshot</span></span><br><span class="line"><span class="string">ExecStart=/opt/test.sh</span></span><br><span class="line"><span class="string">RemainAfterExit=yes</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=halt.target reboot.target shutdown.target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
<h1 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl <span class="built_in">enable</span> stopSrv</span><br><span class="line">systemctl restart stopSrv</span><br><span class="line">systemctl status stopSrv</span><br></pre></td></tr></table></figure>
<h1 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 有效果</span></span><br><span class="line">reboot</span><br><span class="line">shutdown -r now</span><br><span class="line">shutdown -h now</span><br><span class="line"></span><br><span class="line"><span class="comment"># 无效果</span></span><br><span class="line">poweroff</span><br></pre></td></tr></table></figure>

<blockquote>
<p>此文章来源于网络</p>
</blockquote>
<h1 id="课程中心"><a href="#课程中心" class="headerlink" title="课程中心"></a>课程中心</h1><p><a target="_blank" rel="noopener" href="https://edu.51cto.com/lecturer/13180901.html">Qianj.51CTO</a></p>
</div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/ic-eda/">ic/eda</a><a class="link-muted mr-2" rel="tag" href="/tags/linux/">linux</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/clqtboe0t000140yjel27albg.html"><i class="level-item fas fa-chevron-left"></i><span class="level-item">centos7.9作为运算服务器的一些优化</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/clqtboe0k000040yj6czgbfpq.html"><span class="level-item">IC环境的汇总</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!-->