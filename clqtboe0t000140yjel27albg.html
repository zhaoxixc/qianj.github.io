<div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-12-29T07:43:26.000Z" title="2023/12/29 15:43:26">2023-12-29</time>发表</span><span class="level-item"><time dateTime="2023-12-31T10:02:01.807Z" title="2023/12/31 18:02:01">2023-12-31</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/qianj-work/">qianj-work</a></span><span class="level-item">5 分钟读完 (大约726个字)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">centos7.9作为运算服务器的一些优化</h1><div class="content"><!-- more -->

<h1 id="内核参数优化"><a href="#内核参数优化" class="headerlink" title="内核参数优化"></a>内核参数优化</h1><h2 id="提高文件描述符限制"><a href="#提高文件描述符限制" class="headerlink" title="提高文件描述符限制"></a>提高文件描述符限制</h2><p>在<code>/etc/security/limits.conf</code>文件中增加以下行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">*       hard   nofile   65536</span><br><span class="line">*       soft   nofile   65536</span><br></pre></td></tr></table></figure>
<h2 id="提高进程数限制"><a href="#提高进程数限制" class="headerlink" title="提高进程数限制"></a>提高进程数限制</h2><p>在<code>/etc/security/limits.conf</code>文件中增加以下行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">*       hard   <span class="built_in">nproc</span>   65536</span><br><span class="line">*       soft   <span class="built_in">nproc</span>   65536</span><br></pre></td></tr></table></figure>
<h2 id="禁用透明大页（Transparent-Huge-Pages）"><a href="#禁用透明大页（Transparent-Huge-Pages）" class="headerlink" title="禁用透明大页（Transparent Huge Pages）"></a>禁用透明大页（Transparent Huge Pages）</h2><p>在<code>/etc/default/grub</code>文件中的<code>GRUB_CMDLINE_LINUX</code>行中增加以下参数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transparent_hugepage=never</span><br></pre></td></tr></table></figure>
<h2 id="禁用NUMA（非统一内存访问）"><a href="#禁用NUMA（非统一内存访问）" class="headerlink" title="禁用NUMA（非统一内存访问）"></a>禁用NUMA（非统一内存访问）</h2><p>在<code>/boot/grub2/grub.cfg</code>文件中<code>menuentry</code>段中的内核启动参数中增加以下参数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">numa=off</span><br></pre></td></tr></table></figure>
<h2 id="调整内核参数"><a href="#调整内核参数" class="headerlink" title="调整内核参数"></a>调整内核参数</h2><p>在<code>/etc/sysctl.conf</code>文件中增加以下行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fs.file-max = 1048576</span><br><span class="line">vm.max_map_count = 262144</span><br></pre></td></tr></table></figure>
<h1 id="网络参数优化"><a href="#网络参数优化" class="headerlink" title="网络参数优化"></a>网络参数优化</h1><h2 id="增加文件句柄限制"><a href="#增加文件句柄限制" class="headerlink" title="增加文件句柄限制"></a>增加文件句柄限制</h2><p>在<code>/etc/security/limits.conf</code>文件中增加以下行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">*       hard   memlock   unlimited</span><br><span class="line">*       soft   memlock   unlimited</span><br></pre></td></tr></table></figure>
<h2 id="调整TCP参数"><a href="#调整TCP参数" class="headerlink" title="调整TCP参数"></a>调整TCP参数</h2><p>在<code>/etc/sysctl.conf</code>文件中增加以下行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">net.ipv4.tcp_max_syn_backlog = 8192</span><br><span class="line">net.core.somaxconn = 8192</span><br><span class="line">net.ipv4.tcp_syncookies = 1</span><br><span class="line">net.ipv4.tcp_max_tw_buckets = 20000</span><br><span class="line">net.ipv4.tcp_tw_reuse = 1</span><br><span class="line">net.ipv4.tcp_fin_timeout = 15</span><br></pre></td></tr></table></figure>
<h1 id="资源管理优化"><a href="#资源管理优化" class="headerlink" title="资源管理优化"></a>资源管理优化</h1><h2 id="禁用THP（Transparent-Huge-Pages）"><a href="#禁用THP（Transparent-Huge-Pages）" class="headerlink" title="禁用THP（Transparent Huge Pages）"></a>禁用THP（Transparent Huge Pages）</h2><p>编辑<code>/etc/rc.d/rc.local</code>文件，在文件末尾添加以下行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/defrag</span><br><span class="line"><span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br></pre></td></tr></table></figure>
<h2 id="禁用IRQ负载平衡"><a href="#禁用IRQ负载平衡" class="headerlink" title="禁用IRQ负载平衡"></a>禁用IRQ负载平衡</h2><p>在<code>/etc/default/grub</code>文件中增加以下参数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">isolcpus=2-15 nohz_full=2-15 rcu_nocbs=2-15</span><br></pre></td></tr></table></figure>
<h2 id="禁用CPU频率调节机制"><a href="#禁用CPU频率调节机制" class="headerlink" title="禁用CPU频率调节机制"></a>禁用CPU频率调节机制</h2><p>在<code>/etc/default/grub</code>文件中增加以下参数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">intel_pstate=<span class="built_in">disable</span></span><br></pre></td></tr></table></figure>
<h2 id="关闭不必要的系统服务"><a href="#关闭不必要的系统服务" class="headerlink" title="关闭不必要的系统服务"></a>关闭不必要的系统服务</h2><p>使用<code>systemctl</code>命令停止和禁用不必要的服务</p>
<h1 id="生产环境已用"><a href="#生产环境已用" class="headerlink" title="生产环境已用"></a>生产环境已用</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 限制</span></span><br><span class="line">$ <span class="built_in">cat</span> /etc/security/limits.d/22-iclab.conf</span><br><span class="line"> @THU hard fsize  52428800</span><br><span class="line"> @THU soft fsize  52428800</span><br><span class="line">  </span><br><span class="line"> @THU hard nofile 10000</span><br><span class="line"> @THU soft nofile 10000</span><br><span class="line">  </span><br><span class="line"> @THU hard <span class="built_in">nproc</span> 9000</span><br><span class="line"> @THU soft <span class="built_in">nproc</span> 9000</span><br><span class="line"></span><br><span class="line"><span class="comment">#禁用ipv6</span></span><br><span class="line">$ <span class="built_in">cat</span> &lt;&lt;<span class="string">EOF &gt;&gt; /etc/sysctl.conf</span></span><br><span class="line"><span class="string">net.ipv6.conf.all.disable_ipv6 = 1</span></span><br><span class="line"><span class="string">net.ipv6.conf.default.disable_ipv6 = 1</span></span><br><span class="line"><span class="string">net.ipv6.conf.default.autoconf=0</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">$ sysctl ‐p</span><br><span class="line"></span><br><span class="line"><span class="comment"># ssh</span></span><br><span class="line">$ sed -i <span class="string">&#x27;s/#X11DisplayOffset.*/X11DisplayOffset 200/g&#x27;</span> /etc/ssh/sshd_config</span><br><span class="line">$ vi /etc/ssh/sshd_config</span><br><span class="line">PubkeyAuthentication <span class="built_in">yes</span></span><br><span class="line">PermitRootLogin <span class="built_in">yes</span></span><br><span class="line">AddressFamily inet</span><br><span class="line">$ systemctl restart sshd</span><br></pre></td></tr></table></figure>

<h1 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># 内核参数优化</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;* hard nofile 65536&quot;</span> &gt;&gt; /etc/security/limits.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;* soft nofile 65536&quot;</span> &gt;&gt; /etc/security/limits.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;* hard nproc 65536&quot;</span> &gt;&gt; /etc/security/limits.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;* soft nproc 65536&quot;</span> &gt;&gt; /etc/security/limits.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;kernel.numa_balancing = 0&quot;</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;fs.file-max = 1048576&quot;</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;vm.max_map_count = 262144&quot;</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line"><span class="comment"># 网络参数优化</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;* hard memlock unlimited&quot;</span> &gt;&gt; /etc/security/limits.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;* soft memlock unlimited&quot;</span> &gt;&gt; /etc/security/limits.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;net.ipv4.tcp_max_syn_backlog = 8192&quot;</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;net.core.somaxconn = 8192&quot;</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;net.ipv4.tcp_syncookies = 1&quot;</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;net.ipv4.tcp_max_tw_buckets = 20000&quot;</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;net.ipv4.tcp_tw_reuse = 1&quot;</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;net.ipv4.tcp_fin_timeout = 15&quot;</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line"><span class="comment"># 资源管理优化</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag&quot;</span> &gt;&gt; /etc/rc.local</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled&quot;</span> &gt;&gt; /etc/rc.local</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;GRUB_CMDLINE_LINUX=\&quot;transparent_hugepage=never\&quot;&quot;</span> &gt;&gt; /etc/default/grub</span><br><span class="line">grub2-mkconfig -o /boot/grub2/grub.cfg</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;GRUB_CMDLINE_LINUX=\&quot;numa=off\&quot;&quot;</span> &gt;&gt; /etc/default/grub</span><br><span class="line">grub2-mkconfig -o /boot/grub2/grub.cfg</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;GRUB_CMDLINE_LINUX=\&quot;isolcpus=2-15 nohz_full=2-15 rcu_nocbs=2-15\&quot;&quot;</span> &gt;&gt; /etc/default/grub</span><br><span class="line">grub2-mkconfig -o /boot/grub2/grub.cfg</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;GRUB_CMDLINE_LINUX=\&quot;intel_pstate=disable\&quot;&quot;</span> &gt;&gt; /etc/default/grub</span><br><span class="line">grub2-mkconfig -o /boot/grub2/grub.cfg</span><br><span class="line"><span class="comment"># 重启系统以使优化生效</span></span><br><span class="line">reboot</span><br></pre></td></tr></table></figure>
<blockquote>
<p>此文章部分来源于网络</p>
</blockquote>
<h1 id="课程中心"><a href="#课程中心" class="headerlink" title="课程中心"></a>课程中心</h1><p><a target="_blank" rel="noopener" href="https://edu.51cto.com/lecturer/13180901.html">Qianj.51CTO</a></p>
</div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/ic-eda/">ic/eda</a><a class="link-muted mr-2" rel="tag" href="/tags/linux/">linux</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/clqtboe1i000o40yj6y654on6.html"><i class="level-item fas fa-chevron-left"></i><span class="level-item">检查系统CPU/MEM利用率</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/clqtboe10000440yj2q0u79hy.html"><span class="level-item">centos7自定义关机前执行脚本</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!-->