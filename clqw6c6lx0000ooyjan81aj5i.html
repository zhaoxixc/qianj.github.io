<div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-01-02T09:44:06.000Z" title="2024/1/2 17:44:06">2024-01-02</time>发表</span><span class="level-item"><time dateTime="2024-01-02T09:55:50.545Z" title="2024/1/2 17:55:50">2024-01-02</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/qianj-work/">qianj-work</a></span><span class="level-item">3 分钟读完 (大约495个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">Centos7 Gnome桌面禁止切换用户、注销和锁屏</h1><div class="content"><p>没有实测，本文仅供参考。</p>
<!-- more -->
<h1 id="禁止logout、切换用户及锁屏"><a href="#禁止logout、切换用户及锁屏" class="headerlink" title="禁止logout、切换用户及锁屏"></a>禁止logout、切换用户及锁屏</h1><p>进入 &#x2F;etc&#x2F;dconf&#x2F;db&#x2F;local.d 目录，没有则自行创建，<br>创建 00-logout 文件，内容如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[org/gnome/desktop/lockdown]</span><br><span class="line">disable-log-out=<span class="literal">true</span></span><br><span class="line">disable-user-switching=<span class="literal">true</span></span><br><span class="line">disable-lock-screen=<span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>进入 &#x2F;etc&#x2F;dconf&#x2F;db&#x2F;local.d&#x2F;locks&#x2F; 目录，，没有则自行创建，<br>创建 lockdown 文件，内容如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/org/gnome/desktop/lockdown/disable-log-out</span><br><span class="line">/org/gnome/desktop/lockdown/disable-user-switching</span><br><span class="line">/org/gnome/desktop/lockdown/disable-lock-screen</span><br></pre></td></tr></table></figure>
<p>最后执行<code>dconf update</code>更新设置。<br>更新完这两项后，点击 gnome 桌面右上角图标，将不再显示用户操作项及锁屏选项，如下<br><img src="/images/linux/linux1.png" alt="更新后的gnome右上角图示"></p>
<h1 id="禁用logout命令"><a href="#禁用logout命令" class="headerlink" title="禁用logout命令"></a>禁用logout命令</h1><p>logout 命令为 shell 自带命令，使用 which 无法查找，也就无法使用 700 权限控制使用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@wds069 ~]<span class="comment"># which logout</span></span><br><span class="line">/usr/bin/which: no <span class="built_in">logout</span> <span class="keyword">in</span> (/usr/lib64/qt-3.3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin)</span><br><span class="line">[root@wds069 ~]<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>这里我们需要用到 enable 命令来控制内置命令<br><code>enable -n logout</code><br>执行这条命令后，我们再执行 logout，提示如下<br><code>logoutbash: logout: command not found...</code><br>至此，Gnome 下就完全禁用了切换用户、退出、锁屏的功能。</p>
<h1 id="禁用重启、关机功能"><a href="#禁用重启、关机功能" class="headerlink" title="禁用重启、关机功能"></a>禁用重启、关机功能</h1><p>对于 reboot、shutdown 命令，因为不属于内置命令，可以使用 chmod 700 的方式来解决。<br>用 which 查找下这两个命令的位置并设置权限即可。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@wds069 ~]<span class="comment"># which reboot</span></span><br><span class="line">/usr/sbin/reboot</span><br><span class="line">[root@wds069 ~]<span class="comment"># which poweroff</span></span><br><span class="line">/usr/sbin/poweroff</span><br><span class="line">[root@wds069 ~]<span class="comment"># which shutdown</span></span><br><span class="line">/usr/sbin/shutdown</span><br><span class="line">[root@wds069 ~]<span class="comment"># </span></span><br><span class="line"></span><br><span class="line">[root@wds069 ~]<span class="comment"># chmod 700 /usr/sbin/reboot</span></span><br><span class="line">[root@wds069 ~]<span class="comment"># chmod 700 /usr/sbin/shutdown</span></span><br><span class="line">[root@wds069 ~]<span class="comment"># chmod 700 /usr/sbin/poweroff</span></span><br></pre></td></tr></table></figure>
<p>为防止用户使用 systemctl reboot -i 的方式强制重启，我们直接禁止普通用户使用 systemctl 命令即可</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@wds069 ~]<span class="comment"># which systemctl</span></span><br><span class="line">/usr/bin/systemctl</span><br><span class="line">[root@wds069 ~]<span class="comment"># </span></span><br><span class="line">[root@wds069 ~]<span class="comment"># chmod 700 /usr/bin/systemctl</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>本文来源于网络，作者张长瑞</p>
</blockquote>
<h1 id="课程中心"><a href="#课程中心" class="headerlink" title="课程中心"></a>课程中心</h1><p><a target="_blank" rel="noopener" href="https://edu.51cto.com/lecturer/13180901.html">Qianj.51CTO</a></p>
</div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/linux/">linux</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/clqx7admq0000twyj09zb5syz.html"><i class="level-item fas fa-chevron-left"></i><span class="level-item">rm进程hang住导致服务器卡</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/clqw4ukie0000l0yj9x4r1tnw.html"><span class="level-item">自动封禁多次ssh fail的IP</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!-->